name: Desligar Servidor Agora
on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  stop-codespace:
    runs-on: ubuntu-latest
    steps:
      - name: Forçar Desligamento
        run: |
          # Busca o nome real (interno) do codespace associado a este repositório
          REAL_NAME=$(gh codespace list --repo ${{ github.repository }} --json name --jq '.[0].name')
          
          if [ -z "$REAL_NAME" ] || [ "$REAL_NAME" == "null" ]; then
            echo "Nenhum codespace ativo encontrado para este repositório."
            exit 0
          fi
          
          echo "Desligando o codespace real: $REAL_NAME"
          gh codespace stop -c "$REAL_NAME"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
