name: Desligar Servidor Agora
on:
  workflow_dispatch:

permissions:
  codespaces: write  # Permissão específica para desligar máquinas

jobs:
  stop-codespace:
    runs-on: ubuntu-latest
    steps:
      - name: Forçar Desligamento
        run: |
          # Busca o nome real do codespace deste repositório
          NAME=$(gh codespace list --repo ${{ github.repository }} --json name --jq '.[0].name')
          
          if [ -z "$NAME" ] || [ "$NAME" == "null" ]; then
            echo "Nenhum codespace ativo encontrado."
          else
            echo "Desligando o codespace: $NAME"
            gh codespace stop -c "$NAME"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
